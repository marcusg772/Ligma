<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Mary vs Marcus">
<link rel="apple-touch-icon" href="icon.png">
<title>Mary vs Marcus ‚Äî Visual Duel</title>
<style>
  :root{
    --bg:#0f1724; --panel:#0b1220; --accent:#E6C07B; --good:#5DD39E; --bad:#FF6B6B;
    --muted:#95A1B3; --card:#0f1724cc;
  }
  body{
    margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
    background: linear-gradient(180deg,#071029 0%, #0b1730 100%); color:#E6EEF8;
    -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
  }
  .wrap{
    max-width:720px; margin:0 auto; padding:18px;
  }
  header{ text-align:center; margin-bottom:8px; }
  h1{ font-size:20px; margin:6px 0; letter-spacing:0.6px; }
  .arena{
    background: radial-gradient(circle at 10% 10%, #0f2a4a40, transparent 30%), rgba(255,255,255,0.02);
    border-radius:14px; padding:14px; display:flex; flex-direction:column; gap:12px;
    box-shadow: 0 6px 18px rgba(2,6,23,0.6); backdrop-filter: blur(6px);
  }

  .fighters{
    display:flex; gap:12px; align-items:center; justify-content:space-between;
    flex-wrap:wrap;
  }
  .fighter{
    flex:1 1 46%; min-width:160px; background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:10px; padding:10px; display:flex; gap:10px; align-items:center;
    border:1px solid rgba(255,255,255,0.03);
    position:relative;
  }
  .portrait{ width:84px; height:84px; flex:0 0 84px; display:flex; align-items:center; justify-content:center; }
  .details{ flex:1; min-width:0; }
  .name{ font-weight:700; font-size:16px; margin-bottom:6px;}
  .hpbar{ height:12px; background:rgba(255,255,255,0.06); border-radius:8px; overflow:hidden; }
  .hpfill{ height:100%; width:100%; background:linear-gradient(90deg,var(--good), #3fbf9a); transform-origin:left; transition:width 500ms ease; }
  .hptext{ font-size:12px; color:var(--muted); margin-top:6px; }
  .vs{ text-align:center; font-weight:700; color:var(--muted); margin:6px 0; }

  .log{
    background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.01));
    padding:10px; border-radius:8px; min-height:72px; font-size:15px;
    border:1px solid rgba(255,255,255,0.02);
  }
  .controls{
    display:flex; gap:8px; margin-top:8px; flex-wrap:wrap;
  }
  .btn{
    flex:1 1 48%; min-width:120px; padding:12px 10px; border-radius:10px; border:none; font-weight:700;
    color:#02101a; background:var(--accent); font-size:15px; box-shadow: 0 6px 12px rgba(0,0,0,0.35);
    touch-action: manipulation;
  }
  .btn.secondary{ background:transparent; color:var(--accent); border:1px solid rgba(230,192,123,0.12); }
  .small{ font-size:13px; padding:9px; }

  /* animations */
  .shake { animation: shake 420ms linear; }
  @keyframes shake {
    0% { transform: translateX(0) }
    20% { transform: translateX(-6px) }
    40% { transform: translateX(6px) }
    60% { transform: translateX(-4px) }
    80% { transform: translateX(4px) }
    100% { transform: translateX(0) }
  }
  .flash { animation: flash 380ms linear; }
  @keyframes flash {
    0% { box-shadow:0 0 0px rgba(255,255,255,0) }
    50% { box-shadow:0 0 18px rgba(255,255,255,0.12) }
    100% { box-shadow:0 0 0px rgba(255,255,255,0) }
  }

  footer{ margin-top:12px; text-align:center; color:var(--muted); font-size:13px; }
  @media (max-width:420px){
    .btn{ flex-basis:100% }
    .fighter{ flex-basis:100% }
    .portrait{ width:64px; height:64px; }
  }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Mary vs Marcus ‚Äî The Amulet Duel</h1>
      <div style="color:var(--muted); font-size:13px;">Tap actions to play ‚Äî works in Safari on iPhone</div>
    </header>

    <section class="arena" role="application" aria-label="Battle arena">
      <div class="fighters">
        <div id="mary" class="fighter" aria-live="polite">
          <div class="portrait" id="maryPortrait" aria-hidden="true">
            <!-- simple avatar SVG -->
            <svg viewBox="0 0 120 120" width="84" height="84" xmlns="http://www.w3.org/2000/svg">
              <defs>
                <linearGradient id="gM" x1="0" y1="0" x2="1" y2="1">
                  <stop offset="0" stop-color="#77D6B8"/>
                  <stop offset="1" stop-color="#2FA27B"/>
                </linearGradient>
              </defs>
              <circle cx="60" cy="60" r="56" fill="url(#gM)"/>
              <circle cx="60" cy="44" r="20" fill="#04242b"/>
              <rect x="28" y="72" width="84" height="30" rx="12" fill="#04242b"/>
              <text x="60" y="72" text-anchor="middle" fill="#E6EEF8" font-size="22" font-weight="700" dy="8">M</text>
            </svg>
          </div>
          <div class="details">
            <div class="name">Mary ‚Ä¢ The Adventurer</div>
            <div class="hpbar" aria-hidden="true"><div id="maryHpFill" class="hpfill"></div></div>
            <div class="hptext" id="maryHpText">HP: 100 / 100</div>
          </div>
        </div>

        <div class="vs">VS</div>

        <div id="marcus" class="fighter" aria-live="polite">
          <div class="portrait" id="marcusPortrait" aria-hidden="true">
            <svg viewBox="0 0 120 120" width="84" height="84" xmlns="http://www.w3.org/2000/svg">
              <defs>
                <linearGradient id="gR" x1="0" y1="0" x2="1" y2="1">
                  <stop offset="0" stop-color="#FF9A9E"/>
                  <stop offset="1" stop-color="#FF6B6B"/>
                </linearGradient>
              </defs>
              <circle cx="60" cy="60" r="56" fill="url(#gR)"/>
              <circle cx="60" cy="44" r="20" fill="#2b1010"/>
              <rect x="28" y="72" width="84" height="30" rx="12" fill="#2b1010"/>
              <text x="60" y="72" text-anchor="middle" fill="#FFEFEF" font-size="22" font-weight="700" dy="8">Ma</text>
            </svg>
          </div>
          <div class="details">
            <div class="name">Marcus ‚Ä¢ The Rival</div>
            <div class="hpbar" aria-hidden="true"><div id="marcusHpFill" class="hpfill" style="background:linear-gradient(90deg,#ff8a8a,#ff5a5a)"></div></div>
            <div class="hptext" id="marcusHpText">HP: 100 / 100</div>
          </div>
        </div>
      </div>

      <div class="log" id="log" role="status" aria-live="polite">The crowd hums with anticipation. Choose Mary‚Äôs action.</div>

      <div class="controls" id="controls">
        <button class="btn" id="attackBtn">Strike ‚öîÔ∏è</button>
        <button class="btn" id="skillBtn">Skill Contest üèπ</button>
        <button class="btn secondary" id="trickBtn">Trick ü™Ñ</button>
        <button class="btn secondary small" id="restartBtn">Restart</button>
      </div>
    </section>

    <footer>Tip: Tap the buttons ‚Äî sound is generated in-browser. Works offline once opened.</footer>
  </div>

<script>
/* Game logic + animations + WebAudio simple SFX */
(() => {
  // state
  const state = {
    mary: {hp:100, max:100},
    marcus: {hp:100, max:100},
    busy:false
  };

  // DOM
  const logEl = document.getElementById('log');
  const maryEl = document.getElementById('mary');
  const marcusEl = document.getElementById('marcus');
  const maryHpFill = document.getElementById('maryHpFill');
  const marcusHpFill = document.getElementById('marcusHpFill');
  const maryHpText = document.getElementById('maryHpText');
  const marcusHpText = document.getElementById('marcusHpText');

  const attackBtn = document.getElementById('attackBtn');
  const trickBtn = document.getElementById('trickBtn');
  const skillBtn = document.getElementById('skillBtn');
  const restartBtn = document.getElementById('restartBtn');

  // audio using WebAudio (no files)
  const AudioCtx = window.AudioContext || window.webkitAudioContext;
  let audioCtx = null;
  function ensureAudio() {
    if (!audioCtx) audioCtx = new AudioCtx();
  }
  function sfx(frequency=440, duration=0.12, type='sine', gain=0.14){
    try {
      ensureAudio();
      const o = audioCtx.createOscillator();
      const g = audioCtx.createGain();
      o.type = type; o.frequency.value = frequency;
      g.gain.value = gain;
      o.connect(g); g.connect(audioCtx.destination);
      o.start();
      g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + duration);
      setTimeout(()=>{ try{o.stop()}catch(e){} }, duration*1000+30);
    } catch(e){}
  }

  // helpers
  function rand(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }
  function writeLog(text){
    logEl.textContent = text;
  }
  function setHpUI(which){
    if (which === 'mary') {
      const p = state.mary.hp / state.mary.max * 100;
      maryHpFill.style.width = p + '%';
      maryHpText.textContent = `HP: ${state.mary.hp} / ${state.mary.max}`;
    } else {
      const p = state.marcus.hp / state.marcus.max * 100;
      marcusHpFill.style.width = p + '%';
      marcusHpText.textContent = `HP: ${state.marcus.hp} / ${state.marcus.max}`;
    }
  }
  function shake(el){ el.classList.remove('shake'); void el.offsetWidth; el.classList.add('shake'); }
  function flash(el){ el.classList.remove('flash'); void el.offsetWidth; el.classList.add('flash'); }

  function disableButtons(val){
    attackBtn.disabled = val;
    trickBtn.disabled = val;
    skillBtn.disabled = val;
    if (val) {
      attackBtn.style.opacity=0.5; trickBtn.style.opacity=0.5; skillBtn.style.opacity=0.5;
    } else {
      attackBtn.style.opacity=1; trickBtn.style.opacity=1; skillBtn.style.opacity=1;
    }
  }

  // game actions
  async function playerAttack(){
    if (state.busy) return;
    state.busy = true; disableButtons(true);
    writeLog("Mary strikes with a swift blow!");
    sfx(560,0.09,'sawtooth',0.14);
    shake(marcusEl); flash(marcusEl);

    await sleep(420);
    const damage = rand(14,26);
    state.marcus.hp = Math.max(0, state.marcus.hp - damage);
    setHpUI('marcus');
    writeLog(`Mary hits Marcus for ${damage} damage.`);

    await sleep(420);
    if (checkEnd()) { state.busy=false; disableButtons(false); return; }

    // Marcus turn
    await enemyTurn();
    state.busy=false; disableButtons(false);
  }

  async function playerTrick(){
    if (state.busy) return;
    state.busy = true; disableButtons(true);
    writeLog("Mary attempts a tricky feint...");
    sfx(800,0.08,'triangle',0.09);
    shake(maryEl);
    await sleep(500);
    const success = Math.random() < 0.62; // favorable chance
    if (success){
      writeLog("The trick works! Marcus is exposed ‚Äî Mary grabs the Amulet!");
      sfx(1200,0.16,'sine',0.16);
      flash(marcusEl);
      // instant victory
      state.marcus.hp = 0; setHpUI('marcus');
      endGame(true, "Trick succeeded ‚Äî Mary wins!");
    } else {
      writeLog("Marcus sees through it and counterattacks!");
      sfx(260,0.08,'sawtooth',0.14);
      await sleep(360);
      await enemyTurn();
      if (!checkEnd()) {
        writeLog("Mary's trick failed. The duel continues.");
      }
    }
    state.busy=false; disableButtons(false);
  }

  async function playerSkillContest(){
    if (state.busy) return;
    state.busy = true; disableButtons(true);
    writeLog("Skill contest! Archery ‚Äî both shoot three arrows...");
    sfx(640,0.09,'square',0.12);
    await sleep(600);
    const maryScore = rand(10,30);
    const marcusScore = rand(10,30);
    writeLog(`Results ‚Äî Mary: ${maryScore} | Marcus: ${marcusScore}`);
    if (maryScore >= marcusScore) {
      writeLog("Mary outshoots Marcus and claims the Amulet!");
      sfx(1200,0.16,'sine',0.16);
      endGame(true, "Skill victory ‚Äî Mary wins!");
    } else {
      // Marcus deals a hit because he wins
      const damage = rand(8,18);
      state.mary.hp = Math.max(0, state.mary.hp - damage);
      setHpUI('mary');
      writeLog(`Marcus wins the contest and lands a strike for ${damage} damage.`);
      sfx(260,0.08,'sawtooth',0.12);
      await sleep(360);
      if (!checkEnd()) writeLog("The duel continues...");
    }
    state.busy=false; disableButtons(false);
  }

  async function enemyTurn(){
    writeLog("Marcus prepares his move...");
    await sleep(550);
    // choose between attack (80%) or special (20%)
    if (Math.random() < 0.78) {
      sfx(260,0.09,'sawtooth',0.12);
      shake(maryEl); flash(maryEl);
      await sleep(220);
      const damage = rand(10,22);
      state.mary.hp = Math.max(0, state.mary.hp - damage);
      setHpUI('mary');
      writeLog(`Marcus slashes Mary for ${damage} damage.`);
    } else {
      // heavy strike
      sfx(200,0.16,'square',0.16);
      shake(maryEl); flash(maryEl);
      await sleep(260);
      const damage = rand(18,28);
      state.mary.hp = Math.max(0, state.mary.hp - damage);
      setHpUI('mary');
      writeLog(`Marcus unleashes a heavy strike for ${damage} damage!`);
    }
    await sleep(180);
    checkEnd();
  }

  function checkEnd(){
    if (state.marcus.hp <= 0){
      endGame(true, "Marcus is defeated ‚Äî Mary claims the Amulet!");
      return true;
    }
    if (state.mary.hp <= 0){
      endGame(false, "Mary fell ‚Äî Marcus takes the Amulet.");
      return true;
    }
    return false;
  }

  function endGame(victory, reason){
    flash(document.querySelector('.arena'));
    sfx(victory ? 1200 : 180, 0.18, victory ? 'sine' : 'sawtooth', 0.16);
    writeLog(reason);
    disableButtons(true);
  }

  // utilities
  function sleep(ms){ return new Promise(r => setTimeout(r, ms)); }

  // wiring
  attackBtn.addEventListener('click', playerAttack);
  trickBtn.addEventListener('click', playerTrick);
  skillBtn.addEventListener('click', playerSkillContest);
  restartBtn.addEventListener('click', ()=>{
    state.mary.hp = state.mary.max;
    state.marcus.hp = state.marcus.max;
    setHpUI('mary'); setHpUI('marcus');
    writeLog("The duel resets. Mary stands ready.");
    disableButtons(false);
  });

  // init UI
  setHpUI('mary'); setHpUI('marcus');
  writeLog("The crowd hums with anticipation. Choose Mary‚Äôs action.");
})();
</script>
</body>
</html>
